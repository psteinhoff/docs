

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>&lt;no title&gt; &mdash; OpenPTV 0.00.001 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.00.001',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="OpenPTV 0.00.001 documentation" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="index.html">OpenPTV 0.00.001 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <p><em>new experiment:</em></p>
<ul class="simple">
<li>For a new set of experiments open a new file. The file should contain</li>
</ul>
<p>the following files: cal: for calibration, parameters, img and res</p>
<p>a clean file for example (copy it and rename the file) is in
ptv/fresh_test .</p>
<p><em>Calibration:</em></p>
<ul class="simple">
<li>The cal file contains: 4 calibration pictures, one for each camera, 4</li>
</ul>
<p>ori files (orientaion files), and a calblock.txt file.</p>
<ul class="simple">
<li>The calblock.txt file contains the coordinates of each dot on the</li>
</ul>
<p>calibration target in x,y and z . calblock_20.txt is for 20 dots, it
can be changed to any number of dots, according to the calibration
target and the calibration pictures.</p>
<ul class="simple">
<li>Ori files: camera’s orientation files:</li>
</ul>
<p>The first 9 parameters are the coordinates of the camera with respect to
the reference calibration target and the camera angles:</p>
<p>First row: distance. Second row: the angle [radian].</p>
<p>First column :x. Second column: y. Third column: z.</p>
<p>3x3 matrix: rotation matrix</p>
<p>2 parameters: Xp and Yp of the pinhole</p>
<p>focal distance: if we have a ratio of world image to chip image of 500mm
to 65 mm( 384pixels is17microns), e.g. 1:8. The distance from lens to
calibration target is about 800mm. Hence the focal distance is about
100mm.</p>
<p>3 parameters: the position of the glass according to the zero point.</p>
<p>In the first run- choose reasonable parameters according to the cameras
positions in the experiment.</p>
<ul class="simple">
<li>Gain 4 calibration pictures, one for each camera, and copy them to the</li>
</ul>
<p>cal file.</p>
<ul class="simple">
<li>right click on the current run. choose calibration parameters:</li>
</ul>
<p><em>Image data:</em></p>
<p>Fill in the name of the four calibration pictures ,four orientation data
pictures and file of coordinates on plate.</p>
<p>[h] <img alt="image0" src="_images/fig1.png" /></p>
<p><em>Calibration data detection:</em></p>
<p>Different parameters in order to detect the dots on the calibration
target.</p>
<p>[h] <img alt="image1" src="_images/fig2.png" /></p>
<p><em>Manual pre-orientation:</em></p>
<p>Fill in the numbers of four points on the calibration target. The
numbers should be set as chosen in manual orientation.</p>
<p>[h] <img alt="image2" src="_images/fig3.png" /></p>
<p><em>Calibration orientation parameters:</em></p>
<p>The lens distortion is modeled with up to five parameters :k1,k2,k3+
p1,p2</p>
<p>Affin transformation: scx, she</p>
<p>Principle distance: xp, yp</p>
<p>In the first calibration process don’t mark those parameters. After
establishing the calibration, the different parameters can be marked in
order to improve the calibration.</p>
<p>[h] <img alt="image3" src="_images/fig4.png" /></p>
<ul class="simple">
<li>In the upper toolbar choose : calibration and create calibration</li>
</ul>
<p><em>load/show images</em>: shows the calibration images</p>
<p><em>detection</em>: detect the calibration dots on the calibration image. check
that all the dots were identified correctly and marked in blue, and that
there aren’t any extra dots.</p>
<p>mark the four points from the manual pre-orientation in each camera and
press manual orient. This creates the man_ori.dat. Next time, skip this
stage and press detection and then orient with file.</p>
<p><em>show initial guess:</em> &nbsp;The yellow dots show where the dots from the
calibration plane would end up on your images if the initial guess would
be correct.</p>
<p>If the yellow dots aren’t in the right location, change the ori files -
edit ori files and press show initial guess again to see the change, do
it until the yellow and blue dots match.</p>
<p>Check that the position of each camera according to the ori files is
also reasonable according to the cameras position in reality.</p>
<p><em>sort grid:</em> situates all the dots in their positions. Check that all
dots were found and marked correctly.</p>
<p><em>orientation</em>: creates the orientation.</p>
<p>In order to improve the orientation : mark some of the Calibration
orientation parameters and press orientation again.</p>
<p><em>Dumbbell calibration:</em></p>
<p>Sometimes it is inconvenient to position a calibration target. Either
because there is something in the way, or because it is cumbersome to
get the entire target again out of the observation domain. It would be
much easier to move a simple object randomly around the observation
domain and from this perform the calibration.</p>
<p>This is what <a href="#id1"><span class="problematic" id="id2">``</span></a><tt class="docutils literal"><span class="pre">\</span> <span class="pre">Dumbbell</span> <span class="pre">calibration\</span> <span class="pre">``</span></tt> is doing. The simple
object is a dumbbell with two points separated at a known distance. A
very rough initial guess is sufficient to solve the correspondence
problem for only two particles per image. In other words, the tolerable
epipolar band width is very large: large enough to also find the
correspondence for a very rough calibration, but small enough so as not
to mix up the two points. From there on, calibration optimizes the
distances by which the epipolar lines miss each other, while maintaining
the detected distance of the dumbbell points.</p>
<p>Unlike previous calibration approaches, Dumbbell calibration uses all
camera views simultaneously. [RequiredHinput]</p>
<p><em>Required input</em></p>
<p>[h] <img alt="image4" src="../images/fig5.jpg" /></p>
<p>Somehow, an object with two well visible points has to be moved through
the observation domain and recorder. The dumbbells points should be
separated by roughly a third of the observation scale.</p>
<p>Note that the accuracy by which these dumbbell points can be determined
in 2d, also defines the possible accuracy in 3d.</p>
<p><em>Processing:</em></p>
<ul class="simple">
<li>Copy at least 500 images of the dumbbell (for each camera) as a tiff</li>
</ul>
<p>file to a new file Prepare target files using matlab code:
tau_dumbbell_detection_db_v3b .Every target file should contain only
2 points.</p>
<ul class="simple">
<li>Right click on the current run: choose main parameters.</li>
</ul>
<p><em>Main parameters</em>:</p>
<p>write the name of the first dumbbell image, and the name of the
calibration images you want to use.</p>
<p>[h] <img alt="image5" src="_images/fig6.png" /></p>
<p><em>Particle recognition:</em></p>
<p>since there are ready target files, mark <a href="#id3"><span class="problematic" id="id4">``</span></a><tt class="docutils literal"><span class="pre">\</span> <span class="pre">use</span>
<span class="pre">existing\_target\_files\</span> <span class="pre">``</span></tt>.</p>
<p>[h] <img alt="image6" src="_images/fig7.png" /></p>
<p><em>Sequence processing:</em></p>
<p>Fill in the numbers of the first and last picture in the sequence
processing, and the base name for every camera.</p>
<p>[h] <img alt="image7" src="_images/fig8.png" /></p>
<p><em>Criteria for correspondences:</em></p>
<p>min corr for ratio nx:</p>
<p>min corr for ratio ny:</p>
<p>min corr for ratio npix:</p>
<p>sum of gv:</p>
<p>min for weighted correlation:</p>
<p>tol band: The number that defines the distance from the epipolar line to
the possible candidate [mm].</p>
<p>[h] <img alt="image8" src="_images/fig9.png" /></p>
<p><a href="#id5"><span class="problematic" id="id6">*</span></a>Processing of a single time step: *</p>
<ul class="simple">
<li>In the upper toolbar choose: start and then pre-tracking ,image</li>
</ul>
<p>coordinate, after that the two points of the dumbbell are detected. Then
choose pre-tacking, correspondence. This establish correspondences
between the detected dumbbell from one camera to all other cameras</p>
<ul class="simple">
<li>you can press one point of the dumbbell in each camera and to see the</li>
</ul>
<p>epipolar lines.</p>
<p>The processing of a single time step is necessary to adjust parameters
like grey value thresholds or tolerance to the epipolar line.</p>
<p>[h] <img alt="image9" src="_images/fig10.png" /></p>
<ul class="simple">
<li>In the upper toolbar choose: sequence, sequence without display</li>
<li>In the upper toolbar choose: tracking, detected particles. Then</li>
</ul>
<p>tracking, tracking without display and then show trajectory.</p>
<ul class="simple">
<li>Right click on the current run. choose calibration parameters:</li>
</ul>
<p><em>Dumbbell calibration parameters:</em></p>
<p>[h] <img alt="image10" src="_images/fig11.png" /></p>
<p><em>Eps [mm]:</em> It is the tolerable bandwith by which epipolar lines are
allowed to miss each other during calibration. should be the same number
as the tol. band in <a href="#id7"><span class="problematic" id="id8">``</span></a><tt class="docutils literal"><span class="pre">\</span> <span class="pre">Criteria</span> <span class="pre">for</span> <span class="pre">correspondences\</span> <span class="pre">``</span></tt></p>
<p><em>Dumbbell scale [mm]</em> :distance between the dumbbell points. It is quite
important Since the algorithm optimizes two targets, the epipolar
mismatch and the scale of the dumbbell particle pair.</p>
<p><em>Gradient descent factor</em>: if everything would be linear then a factor
of 1 would converge after one step. Generally one is a bit instable
though, so a more careful, but slow, value is 0.5.</p>
<p><em>Weight for dumbbell penalty</em>: this is the relative weight that is given
to the dumbbell scale penalty. with one it is equally bad to have
dumbbell scale of only 24mm and to have epipolar mismatch of 1mm. After
rough converge this value can be reduced to 0.01-0.2, since it is
difficult to precisely even measure this scale.</p>
<p><em>Step size through sequence</em>: it is step size. It could be different
then 1 when the dumbbell recording is very long with successive images
that are almost identical, then step size of 10 or so might be more
appropriate.</p>
<ul class="simple">
<li>In the upper toolbar choose : calibration and create calibration.</li>
</ul>
<p>choose orient with dumbbell.</p>
<p><a href="#id9"><span class="problematic" id="id10">*</span></a>Shaking calibration: *</p>
<p>[h] <img alt="image11" src="_images/fig12.png" /></p>
<p><em>Processing of a single time step</em></p>
<p><em>Main parameters</em>:</p>
<p>Write the name of the first image, and the name of the calibration
images you want to use.</p>
<p>[h] <img alt="image12" src="_images/fig13.png" /></p>
<p><em>Particle recognition:</em></p>
<p>Don’t mark <a href="#id11"><span class="problematic" id="id12">``</span></a><tt class="docutils literal"><span class="pre">\</span> <span class="pre">use</span> <span class="pre">existing\_target\_files\</span> <span class="pre">``</span></tt>. fill the particle
recognition parameters in order to find the particles.</p>
<p>[h] <img alt="image13" src="_images/fig14.png" /></p>
<ul class="simple">
<li>Press start in the upper toolbar. the four picture images from</li>
</ul>
<p><a href="#id13"><span class="problematic" id="id14">``</span></a><tt class="docutils literal"><span class="pre">\</span> <span class="pre">main</span> <span class="pre">parameters,</span> <span class="pre">general\</span> <span class="pre">``</span></tt> will appear.</p>
<p>[h] <img alt="image14" src="_images/fig15.png" /></p>
<ul class="simple">
<li>Under Pretracking the processing of a single time step regularly</li>
</ul>
<p>starts with the application of a highpass filtering (Highpass). After
that the particles are detected (Image Coord) and the* <a href="#id15"><span class="problematic" id="id16">*</span></a>position of
each particle is determined with a weighted grey value operator. The
next step is to establish correspondences between the detected particles
from one camera to all other cameras (Correspondences).</p>
<p>[h] <img alt="image15" src="_images/fig16.png" /></p>
<p>The processing of a single time step is necessary to adjust parameters
like grey value thresholds or tolerance to the epipolar line.</p>
<p><em>Sequence:</em></p>
<p>After having optimized the parameters for a single time step the
processing of the whole image sequence can be performed under Sequence .</p>
<ul class="simple">
<li>Under main parameters, Sequence processing* <a href="#id17"><span class="problematic" id="id18">*</span></a>Fill in the numbers</li>
</ul>
<p>of the first and last picture in the sequence processing, and the base
name for every camera.</p>
<ul class="simple">
<li>In the upper toolbar choose sequence with or without display of the</li>
</ul>
<p>currently processed image data. It is not advisable to use the display
option when long image sequences are processed. The display of detected
particle positions and the established links can be very time consuming.</p>
<p>For each time step the detected image coordinates and the 3D coordinates
are written to files,</p>
<p>which are later used as input data for the Tracking procedure.</p>
<p><a href="#id19"><span class="problematic" id="id20">*</span></a>Tracking: *</p>
<p><em>Tracking parameters:</em></p>
<p>Before the tracking can be performed several parameters defining the
velocity, acceleration and direction divergence of the particles have to
be set in the submenu Tracking Parameters. The flag‘</p>
<p>Add new particles position’ is essential to benefit from the
capabilities of the</p>
<p>enhanced method. To derive a velocity field from the observed flow.</p>
<p>[h] <img alt="image16" src="_images/fig17.png" /></p>
<ul class="simple">
<li>Tracking, Detected Particles displays the detected particles from the</li>
</ul>
<p>sequence processing.</p>
<p>[h] <img alt="image17" src="_images/fig18.png" /></p>
<ul class="simple">
<li>Choose tracking, tracking without display. Again it is not advisable</li>
</ul>
<p>to use the display option if long sequences are processed. The tracking
procedure allows bidirectional tracking.</p>
<ul class="simple">
<li>Tracking, show Trajectories displays the reconstructed trajectories in</li>
</ul>
<p>all image display windows.</p>
<p>[h] <img alt="image18" src="_images/fig19.png" /></p>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/pyptv.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="index.html">OpenPTV 0.00.001 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, OpenPTV Team.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
  </body>
</html>